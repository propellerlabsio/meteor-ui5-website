/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/thirdparty/URI','sap/ui/Device'],function(q,U,D){"use strict";var l="Opa5 - finding controls",$=q,f=null,F=null,o=null,a=null,b=null,r=false,u=false;function h(){f=F[0].contentWindow;c();d();}function c(){if(D.browser.internet_explorer&&D.browser.version===9){return;}var j=f.onerror;f.onerror=function(E,k,L){if(j){j.apply(this,arguments);}throw"OpaFrame error message: "+E+" url: "+k+" line: "+L;};}function d(){if(u){return true;}if(f&&f.sap&&f.sap.ui&&f.sap.ui.getCore){if(!r){f.sap.ui.getCore().attachInit(e);}r=true;}return u;}function e(){u=true;s();m();}function m(){f.jQuery.sap.require("sap.ui.thirdparty.hasher");f.jQuery.sap.require("sap.ui.core.routing.History");f.jQuery.sap.require("sap.ui.core.routing.HashChanger");var H=new f.sap.ui.core.routing.HashChanger(),j=new f.sap.ui.core.routing.History(H),k=f.hasher,O=k.setHash,n=k.getHash,C,p=f.history.go;k.replaceHash=function(w){var x=this.getHash();C=w;H.fireEvent("hashReplaced",{sHash:w});this.changed.dispatch(w,x);};k.setHash=function(w){var R=n.call(this);C=w;H.fireEvent("hashSet",{sHash:w});O.apply(this,arguments);if(R===this.getHash()){this.changed.dispatch(R,j.aHistory[j.iHistoryPosition]);}};k.getHash=function(){if(C===undefined){return n.apply(this,arguments);}return C;};H.init();function t(){var N=j.aHistory[j.iHistoryPosition],w=j.getPreviousHash();C=w;k.changed.dispatch(w,N);}function v(){var N=j.aHistory[j.iHistoryPosition+1],w=j.aHistory[j.iHistoryPosition];if(N===undefined){q.sap.log.error("Could not navigate forwards, there is no history entry in the forwards direction",this);return;}C=N;k.changed.dispatch(N,w);}f.history.back=t;f.history.forward=v;f.history.go=function(S){if(S===-1){t();return;}else if(S===1){v();return;}q.sap.log.error("Using history.go with a number greater than 1 is not supported by OPA5",this);return p.apply(f.history,arguments);};}function s(){b=f.jQuery;g("sap.ui.test");b.sap.require("sap.ui.test.OpaPlugin");o=new f.sap.ui.test.OpaPlugin(l);g("sap.ui.qunit.QUnitUtils");f.jQuery.sap.require("sap.ui.qunit.QUnitUtils");a=f.sap.ui.qunit.QUnitUtils;}function g(M){var O=q.sap.getModulePath(M);var A=new U(O).absoluteTo(document.baseURI).search("").toString();b.sap.registerModulePath(M,A);}function i(){f.onerror=$.noop;F.remove();b=null;o=null;a=null;f=null;u=false;r=false;}return{launch:function(j){if(f){$.sap.log.error("sap.ui.test.launchers.iFrameLauncher: Only one IFrame may be loaded at a time.");return;}F=$("#"+j.frameId);if(!F.length){if(!j.source){$.sap.log.error("No source was given to launch the IFrame",this);}F=$('<IFrame id="'+j.frameId+'" class="opaFrame" src="'+j.source+'"></IFrame>');$("body").append(F);}if(F[0].contentDocument&&F[0].contentDocument.readyState==="complete"){h();}else{F.on("load",h);}return d();},getHashChanger:function(){if(!f){return null;}f.jQuery.sap.require("sap.ui.core.routing.HashChanger");return f.sap.ui.core.routing.HashChanger.getInstance();},getPlugin:function(){return o;},getJQuery:function(){return b;},getUtils:function(){return a;},hasLaunched:function(){d();return u;},getWindow:function(){return f;},teardown:function(){i();},_sLogPrefix:l};},true);
