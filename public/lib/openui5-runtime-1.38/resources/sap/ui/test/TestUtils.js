/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define('sap/ui/test/TestUtils',['jquery.sap.global','sap/ui/core/Core'],function(q){"use strict";var r=/\/\$batch($|\?)/,m={},R=q.sap.getUriParameters().get("realOData"),a=/^GET (\S+) HTTP\/1\.1$/,p=R==="true"||R==="proxy",b=p||R==="direct",T;function d(A,e,P){var s=QUnit.objectType(A),E=QUnit.objectType(e),n;if(s!==E){throw new Error(P+": actual type "+s+" does not match expected type "+E);}if(s==="array"){if(A.length<e.length){throw new Error(P+": array length: "+A.length+" < "+e.length);}}if(s==="array"||s==="object"){for(n in e){d(A[n],e[n],P==="/"?P+n:P+"/"+n);}}else if(A!==e){throw new Error(P+": actual value "+A+" does not match expected value "+e);}}function c(A,e,M,E){try{d(A,e,"/");QUnit.push(E,A,e,M);}catch(f){QUnit.push(!E,A,e,(M||"")+" failed because of "+f.message);}}T={deepContains:function(A,e,M){c(A,e,M,true);},notDeepContains:function(A,e,M){c(A,e,M,false);},useFakeServer:function(s,B,f){function e(u,o){var l=o.requestBody,n,t,v=[""];n=i(l);t=l.split(n).slice(1,-1);t.forEach(function(w){var M,x,y;w=w.slice(w.indexOf("\r\n\r\n")+4);x=i(w);M=a.exec(x);y=M&&u[M[1]];if(y){v.push("\r\n"+y);q.sap.log.info(x,null,"sap.ui.test.TestUtils");}else{v.push("\r\nContent-Type: application/http\r\n"+"content-transfer-encoding: binary\r\n\r\n"+"HTTP/1.1 404 Not Found\r\n"+"Content-Type: text/plain\r\n\r\nNo mock data found\r\n");q.sap.log.error(x,"No mock data found","sap.ui.test.TestUtils");}});v.push("--\r\n");o.respond.apply(o,[200,{"Content-Type":"multipart/mixed; boundary="+n.slice(2)},v.join(n)]);}function g(f,I){var H,M,o,u,U={};for(u in f){o=f[u];H=o.headers||{};if(!I&&r.test(u)){U[u]=e.bind(null,g(o,true));}else{if(o.source){M=j(B+o.source);if(I){M=M.replace(/\n/g,"\r\n");}else{H["Content-Type"]=H["Content-Type"]||h(o.source);}}else{M=o.message||"";}U[u]=I?M:[o.code||200,H,M];}}return U;}function h(n){if(/\.xml$/.test(n)){return"application/xml";}if(/\.json$/.test(n)){return"application/json";}return"application/x-octet-stream";}function i(t){return t.slice(0,t.indexOf("\r\n"));}function j(P){var M=m[P],o;if(!M){o=q.sap.sjax({url:P,dataType:"text"});if(!o.success){throw new Error(P+": resource not found");}m[P]=M=o.data;}return M;}function k(){var l,S,u=g(f,false),U;S=s.useFakeServer();S.autoRespond=true;for(U in u){S.respondWith(U,u[U]);}l=S.restore;S.restore=function(){sinon.FakeXMLHttpRequest.filters=[];l.apply(this,arguments);};}sinon.xhr.supportsCORS=true;B="/"+window.location.pathname.split("/")[1]+"/test-resources/"+B+"/";k();sinon.FakeXMLHttpRequest.useFilters=true;sinon.FakeXMLHttpRequest.addFilter(function(M,u,A){return!(u in f);});},withNormalizedMessages:function(C){sinon.test(function(){var o=sap.ui.getCore(),g=o.getLibraryResourceBundle;this.stub(o,"getLibraryResourceBundle").returns({getText:function(k,A){var s=k,t=g.call(o).getText(k),i;for(i=0;i<10;i+=1){if(t.indexOf("{"+i+"}")>=0){s+=" "+(i>=A.length?"{"+i+"}":A[i]);}}return s;}});C.apply(this);}).apply({});},isRealOData:function(){return b;},proxy:function(A){return p?"/"+window.location.pathname.split("/")[1]+"/proxy"+A:A;},setupODataV4Server:function(s,f,S,F){var e={},g=false;F=F||"";Object.keys(f).forEach(function(u){if(!b||f[u].always){e[F+u]=f[u];g=true;}});if(g){T.useFakeServer(s,S||"sap/ui/core/qunit/odata/v4/data",e);}}};return T;},true);
