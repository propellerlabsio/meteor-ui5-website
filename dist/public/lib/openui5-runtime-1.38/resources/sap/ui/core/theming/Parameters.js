/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/thirdparty/URI','../Element'],function(q,U,E){"use strict";var P={};var p=null;var t=null;var a=[];function r(){p=null;}function m(C,n){for(var s in n){if(typeof C[s]==="undefined"){C[s]=n[s];}}return C;}function b(n){if(typeof n["default"]!=="object"){n={"default":n,"scopes":{}};}p=p||{};p["default"]=p["default"]||{};p["scopes"]=p["scopes"]||{};m(p["default"],n["default"]);if(typeof n["scopes"]==="object"){for(var s in n["scopes"]){p["scopes"][s]=p["scopes"][s]||{};m(p["scopes"][s],n["scopes"][s]);}}}function c(h,R){var i=/^url\(['|"]{1}(?!https?:\/\/|\/)(.*)['|"]{1}\)$/,A=R.replace(/library-parameters\.json.*/,"");for(var I in h){if(i.test(h[I])){h[I]=h[I].replace(i,function($,j,k){var n=new U(A+j).normalize().path();return"url('"+n+"')";});}}return h;}function f(C){q("link[id^=sap-ui-theme-]").each(function(){C(this.getAttribute("id"),this.href);});if(q.sap._mIEStyleSheets){for(var i in q.sap._mIEStyleSheets){if(i.indexOf("sap-ui-theme-")===0){var s=q.sap._mIEStyleSheets[i];if(typeof s.href==="string"){C(i,s.href);}}}}}function l(i,u){var $=q.sap.byId(i);if($.length>0&&q.sap.getUriParameters().get("sap-ui-xx-no-inline-theming-parameters")!=="true"){var D=$.css("background-image");var h=/\(["']data:text\/plain;utf-8,(.*)["']\)$/i.exec(D);if(h&&h.length>=2){var s=h[1];if(s.charAt(0)!=="{"&&s.charAt(s.length-1)!=="}"){try{s=decodeURI(s);}catch(k){q.sap.log.warning("Could not decode theme parameters URI from "+u);}}try{var o=q.parseJSON(s);b(o);return;}catch(k){q.sap.log.warning("Could not parse theme parameters from "+u+". Loading library-parameters.json as fallback solution.");}}}var R,n;u=u.replace(/\/library([^\/.]*)\.(?:css|less)($|[?#])/,function(v,w,x){return"/library-parameters.json"+(x?x:"");});R=q.sap.sjax({url:u,dataType:'json'});if(R.success){n=R.data;if(q.isArray(n)){for(var j=0;j<n.length;j++){var o=n[j];o=c(o,u);b(o);}}else{n=c(n,u);b(n);}}else{q.sap.log.warning("Could not load theme parameters from: "+u);}}function g(){if(!p){p={};t=sap.ui.getCore().getConfiguration().getTheme();f(l);}return p;}function d(){a.forEach(function(i){l("sap-ui-theme-"+i.id,i.url);});a=[];}P._addLibraryTheme=function(T,C){if(p){a.push({id:T,url:C});}};function e(o){var h=g();if(o.scopeName){h=h["scopes"][o.scopeName];}else{h=h["default"];}var s=h[o.parameterName];if(typeof s==="undefined"&&typeof o.parameterName==="string"){var i=o.parameterName.indexOf(":");if(i!==-1){o.parameterName=o.parameterName.substr(i+1);}s=h[o.parameterName];}if(o.loadPendingParameters&&typeof s==="undefined"){d();s=e({parameterName:o.parameterName,scopeName:o.scopeName,loadPendingParameters:false});}return s;}P.get=function(n,C){var s,o;if(arguments.length===0){d();o=g();return q.extend({},o["default"]);}if(typeof n==="string"){if(C instanceof E){d();o=g();var S=Object.keys(o["scopes"]);var h=function(k){return typeof C.hasStyleClass==="function"&&C.hasStyleClass(k);};while(C){var F=S.filter(h);if(F.length>0){for(var i=0;i<F.length;i++){var j=F[i];s=e({parameterName:n,scopeName:j});if(s){return s;}}}C=typeof C.getParent==="function"&&C.getParent();}}return e({parameterName:n,loadPendingParameters:true});}};P._setOrLoadParameters=function(L){p={"default":{},"scopes":{}};t=sap.ui.getCore().getConfiguration().getTheme();f(function(i,h){var s=i.substr(13);if(L[s]){q.extend(p["default"],L[s]);}else{l(i,h);}});};P.reset=function(){var o=arguments[0]===true;if(!o||sap.ui.getCore().getConfiguration().getTheme()!==t){r();}};P._getThemeImage=function(s,F){s=s||"sapUiGlobalLogo";var h=P.get(s);if(h){var i=/url[\s]*\('?"?([^\'")]*)'?"?\)/.exec(h);if(i){h=i[1];}else if(h==="''"||h==="none"){h=null;}}if(!!F&&!h){return sap.ui.resource('sap.ui.core','themes/base/img/1x1.gif');}return h;};return P;},true);
