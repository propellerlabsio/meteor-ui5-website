/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','./Opa','./OpaPlugin','./PageObjectFactory','sap/ui/qunit/QUnitUtils','sap/ui/base/Object','sap/ui/Device','./launchers/iFrameLauncher','./launchers/componentLauncher','sap/ui/core/routing/HashChanger','./matchers/Matcher','./matchers/AggregationFilled','./matchers/PropertyStrictEquals','./pipelines/MatcherPipeline','./pipelines/ActionPipeline'],function(q,O,a,P,U,b,D,f,c,H,M,A,d,e,g){"use strict";var $=q,p=new a(f._sLogPrefix),m=new e(),o=new g(),F="OpaFrame";var h=b.extend("sap.ui.test.Opa5",q.extend({},O.prototype,{constructor:function(){O.apply(this,arguments);}}));function s(S,T){this.waitFor({viewName:null,controlType:null,id:null,searchOpenDialogs:false,success:function(){i(S);}});var k=j();k.check=f.hasLaunched;k.timeout=T||80;k.errorMessage="unable to load the IFrame with the url: "+S;return this.waitFor(k);}h.prototype.iStartMyUIComponent=function iStartMyUIComponent(k){var C=false;k=k||{};this.waitFor({viewName:null,controlType:null,id:null,searchOpenDialogs:false,success:function(){var n=q.sap.getModulePath("sap.ui.test.OpaCss",".css");q.sap.includeStyleSheet(n);H.getInstance().setHash(k.hash||"");c.start(k.componentConfig).then(function(){C=true;});}});var l=j();l.errorMessage="Unable to load the component with the name: "+k.name;l.check=function(){return C;};if(k.timeout){l.timeout=k.timeout;}return this.waitFor(l);};h.prototype.iTeardownMyUIComponent=function iTeardownMyUIComponent(){return this.waitFor({success:function(){c.teardown();}});};h.prototype.iTeardownMyApp=function(){var k=j();k.success=function(){if(f.hasLaunched()){this.iTeardownMyAppFrame();}else if(c.hasLaunched()){this.iTeardownMyUIComponent();}else{var E="A teardown was called but there was nothing to tear down use iStartMyComponent or iStartMyAppInAFrame";$.sap.log.error(E,"Opa");throw new Error(E);}}.bind(this);return this.waitFor(k);};h.iStartMyAppInAFrame=s;h.prototype.iStartMyAppInAFrame=s;function t(){return this.waitFor({success:function(){f.teardown();}});}h.iTeardownMyAppFrame=t;h.prototype.iTeardownMyAppFrame=t;h.prototype.waitFor=function(k){var v=k.actions;k=$.extend({},O.config,k);var l=k.check,C=null,n=k.success,r,u;k.check=function(){if(!this._modifyControlType(k)){return false;}var w=$.extend({},k,{interactable:!!v}),p=h.getPlugin();u=p._isLookingForAControl(w);C=p.getMatchingControls(w);if((k.viewName||k.searchOpenDialogs)&&!k.id&&!C||(C&&C.length===0)){q.sap.log.debug("found no controls in view: "+k.viewName+" with controlType "+k.sOriginalControlType,"","Opa");return false;}if(typeof k.id==="string"&&!C){q.sap.log.debug("found no control with the id "+k.id,"","Opa");return false;}if(k.id instanceof RegExp&&!C.length){q.sap.log.debug("found no control with the id regex"+k.id);return false;}if($.isArray(k.id)&&(!C||C.length!==k.id.length)){if(C&&C.length){q.sap.log.debug("found not all controls with the ids "+k.id+" onlyFound the controls: "+C.map(function(x){return x.sId;}));}else{q.sap.log.debug("found no control with the id  "+k.id);}return false;}if(k.sOriginalControlType&&!C.length){q.sap.log.debug("found no controls with the type  "+k.sOriginalControlType,"","Opa");return false;}if((C||!u)&&k.matchers){r=m.process({matchers:k.matchers,control:C});if(!r){return false;}}else{r=C;}if(l){return this._executeCheck(l,r);}return true;};k.success=function(){if(v&&(r||!u)){o.process({actions:v,control:r});}if(n){n.call(this,r);}};return O.prototype.waitFor.call(this,k);};h.getPlugin=function(){return f.getPlugin()||p;};h.getJQuery=function(){return f.getJQuery();};h.getWindow=function(){return f.getWindow();};h.getUtils=function(){return f.getUtils();};h.getHashChanger=function(){return f.getHashChanger();};h.extendConfig=O.extendConfig;h.resetConfig=function(){O.resetConfig();O.extendConfig({viewNamespace:"",arrangements:new h(),actions:new h(),assertions:new h(),visible:true,_stackDropCount:1});};h.emptyQueue=O.emptyQueue;h.getContext=O.getContext;h.matchers={};h.matchers.Matcher=M;h.matchers.AggregationFilled=A;h.matchers.PropertyStrictEquals=d;h.createPageObjects=function(k){return P.create(k,h);};h.prototype._modifyControlType=function(k){var C=k.controlType;if(typeof C!=="string"){return true;}var l=h.getPlugin().getControlConstructor(C);if(!l){return false;}k.controlType=l;return true;};h.prototype._executeCheck=function(C,v){q.sap.log.debug("Opa is executing the check: "+C);var r=C.call(this,v);q.sap.log.debug("Opa check was "+r);return r;};h.resetConfig();function i(S){var I=q.sap.getModulePath("sap.ui.test.OpaCss",".css");q.sap.includeStyleSheet(I);return f.launch({frameId:F,source:S});}function j(){return{viewName:null,controlType:null,id:null,searchOpenDialogs:false};}$(function(){if($("#"+F).length){i();}$("body").addClass("sapUiBody");$("html").height("100%");});return h;},true);
