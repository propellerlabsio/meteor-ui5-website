/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/Object','sap/ui/base/EventProvider'],function(q,O,E){"use strict";var e=new E(),a,c;var H=O.extend("HeaderAdapter",{constructor:function(h,A){if(!h||!A){q.sap.log.error("Cannot initialize: Invalid arguments.");return;}this._oHeader=h;this._oTitleInfo=null;this._oSubTitleInfo=null;this._oBackButton=null;this._oAdaptOptions=A;}});H.prototype.adapt=function(){var s=this._oAdaptOptions.bStylePage,C=this._oAdaptOptions.bCollapseHeader;if(s){this._adaptStyle("sapF2Adapted");}var t=this._adaptTitle(this._oAdaptOptions),B=this._adaptBackButton(this._oAdaptOptions);if(C){this._collapseHeader(t,B);}return{bTitleHidden:t,bBackButtonHidden:B};};H.prototype.getAdaptedContent=function(){return{oTitleInfo:this._oTitleInfo,oSubTitleInfo:this._oSubTitleInfo,bBackButton:this._oBackButton};};H.prototype._adaptTitle=function(){if(!this._isStandardHeader(this._oHeader)||this._oAdaptOptions.bMoveTitle!==true){return false;}this._oTitleInfo=this._detectTitle();this._oSubTitleInfo=this._detectSubTitle();var s=this._oTitleInfo||this._oSubTitleInfo;if(this._oTitleInfo){this._oTitleInfo.oControl.addStyleClass("sapF2AdaptedTitle");}return s;};H.prototype._adaptBackButton=function(){if(!this._isStandardHeader(this._oHeader)||this._oAdaptOptions.bHideBackButton!==true){return false;}var B=false;this.oBackButton=this._detectBackButton();if(this.oBackButton){this.oBackButton.addStyleClass("sapF2AdaptedNavigation");B=true;}return B;};H.prototype._adaptStyle=function(C){var p=this._oHeader.getParent();if(p){p.addStyleClass(C,true);}};H.prototype._isStandardHeader=function(h){return h&&b(h,"sap/m/Bar");};H.prototype._detectTitle=function(){var t;if(this._isStandardHeader(this._oHeader)){var m=this._oHeader.getContentMiddle();if(m.length===1&&i(m[0])){var T=m[0];t={id:T.getId(),text:T.getText(),oControl:T,sChangeEventId:"_change"};}}return t;};H.prototype._detectSubTitle=function(p){if(b(p,"sap/uxap/ObjectPageHeader")){var h=p.getHeaderTitle();if(h){return{id:h.getId(),text:h.getObjectTitle(),oControl:h,sChangeEventId:"_titleChange"};}}};H.prototype._detectBackButton=function(){if(this._isStandardHeader(this._oHeader)){var B=this._oHeader.getContentLeft();if(B.length>0&&b(B[0],"sap/m/Button")&&(B[0].getType()==="Back"||B[0].getType()==="Up"||B[0].getIcon()==="sap-icon://nav-back")){return B[0];}}};H.prototype._collapseHeader=function(t,B){if(this._isStandardHeader(this._oHeader)){var d=this._oHeader.getContentLeft();var m=this._oHeader.getContentMiddle();var f=this._oHeader.getContentRight();if((d.length===0||(d.length===1&&B))&&(m.length===0||(m.length===1&&t))&&(f.length===0)){this._adaptStyle("sapF2CollapsedHeader");}}};var F=O.extend("sap.m.Fiori20Adapter",{});F.attachViewChange=function(l){e.attachEvent("viewChange",l);};F.detachViewChange=function(l){e.detachEvent("viewChange",l);};F.traverse=function(C,A){a={aViewTitles:{},aViewSubTitles:{},aViewBackButtons:{},aAdaptedViews:{},aChangeListeners:{}};c=null;this._doBFS([{oNode:C,oAdaptOptions:A}]);};F._doBFS=function(Q){var n=Q.shift();if(!n){return;}var N=n.oNode,A=n.oAdaptOptions,s=A.iSearchDepth;A=this._applyRules(A,N);if(!N||!this._isAdaptationRequired(A)||(s<=0)){return;}var o=this._processNode(N,A);var C=this._getNodeChildren(N),d=q.extend({},A,{iSearchDepth:this._updateSearchDepth(s,N)});if(o){d=q.extend(d,{bMoveTitle:A.bMoveTitle&&!o.bTitleHidden,bHideBackButton:A.bHideBackButton&&!o.bBackButtonHidden});}C.forEach(function(f){if(f){Q.push({oNode:f,oAdaptOptions:d});}});this._doBFS(Q);};F._processNode=function(C,A){if(C._getAdaptableContent&&q.isFunction(C._getAdaptableContent)){C.attachEvent("_adaptableContentChange",function(f){var g=f.getParameter("adaptableContent");this._adaptContent(g,C,A);}.bind(this));if(b(C,"sap/m/Page")){C._attachModifyAggregation("content",A,function(f){var T=f.getParameter("type"),g=f.getParameter("object");if((T==="add")||(T==="insert")){this._doBFS([{oNode:g,oAdaptOptions:A}]);}},this);}if(b(C,"sap/m/NavContainer")){C.attachNavigate(function(f){this._adaptNavigableView(f.getParameter("to"),A);}.bind(this));}return this._adaptContent(C._getAdaptableContent(),C,A);}if(b(C,"sap/ui/core/ComponentContainer")){var o=C.getComponentInstance();if(!o&&C.getName()&&!C.getDomRef()){var t=this;var d={onBeforeRendering:function(){C.removeEventDelegate(d);t._doBFS([{oNode:C.getComponentInstance(),oAdaptOptions:A}]);}};C.addEventDelegate(d,this);}}};F._getNodeChildren=function(C){if(b(C,"sap/m/NavContainer")){return[C.getCurrentPage()];}if(b(C,"sap/m/SplitContainer")){return[].concat(C.getAggregation("_navMaster"),C.getAggregation("_navDetail"));}if(b(C,"sap/m/Page")){return C.getContent();}if(b(C,"sap/uxap/ObjectPageLayout")){return[C.getHeaderTitle()];}if(b(C,"sap/ui/core/ComponentContainer")){return[C.getComponentInstance()];}if(b(C,"sap/ui/core/Component")){return[C.getAggregation("rootControl")];}return C.findAggregatedObjects(false);};F._updateSearchDepth=function(s,C){if(b(C,"sap/ui/core/mvc/View")||b(C,"sap/ui/core/Component")||b(C,"sap/ui/core/ComponentContainer")){return s;}return s-1;};F._skipDoneAdaptations=function(A){A=q.extend({},A);if(a.aAdaptedViews[c]){A.bStylePage=false;}if(a.aViewTitles[c]){A.bMoveTitle=false;}if(a.aViewBackButtons[c]){A.bHideBackButton=false;}return A;};F._applyRules=function(A,C){var p=C.getParent();if(b(p,"sap/m/SplitContainer")){var I=sap.ui.Device.system.phone,m=A.bMoveTitle,d;if(m){m=I;}var d=A.bHideBackButton;if(d&&!sap.ui.Device.system.phone){d='initialPage';}return q.extend({},A,{bMoveTitle:m,bHideBackButton:d});}if(b(p,"sap/m/NavContainer")){if(A.bHideBackButton==='initialPage'){var f=p._getActualInitialPage()&&(p._getActualInitialPage().getId()===C.getId());return q.extend({},A,{bHideBackButton:f});}}return A;};F._adaptContent=function(C,p,A){if(b(p,"sap/m/Page")||b(p,"sap/uxap/ObjectPageHeader")){return this._adaptHeader(C,A);}if(b(p,"sap/m/NavContainer")){return this._adaptNavigableView(C,A);}};F._adaptHeader=function(h,A){if(!h||!A){return;}var o=new H(h,A),r=o.adapt(),d=o.getAdaptedContent();if(d.oTitleInfo){a.aViewTitles[c]=d.oTitleInfo;this._registerChangeListener(a.aViewTitles,c);}if(d.oSubTitleInfo){a.aViewSubTitles[c]=d.oSubTitleInfo;this._registerChangeListener(a.aViewSubTitles,c);}if(d.oBackButton){a.aViewBackButtons[c]=d.oBackButton;}return r;};F._registerChangeListener=function(t,v){var T=t[v];if(T&&T.oControl&&T.sChangeEventId&&!a.aChangeListeners[T.id]){var C=function(o){var T=t[v];T.text=o.getParameter("newValue");this._fireViewChange(v);}.bind(this);T.oControl.attachEvent(T.sChangeEventId,C);a.aChangeListeners[T.id]=C;}};F._fireViewChange=function(v){e.fireEvent("viewChange",{sViewId:v,oTitleInfo:a.aViewTitles[v],oSubTitleInfo:a.aViewSubTitles[v],oBackButton:a.aViewBackButtons[v]});};F._adaptNavigableView=function(v,A){if(!v||!A){return;}c=v.getId();if(a.aAdaptedViews[c]){A=this._skipDoneAdaptations(A);}A=q.extend({},A,{iSearchDepth:A.iSearchDepth-1});this._doBFS([{oNode:v,oAdaptOptions:A}]);a.aAdaptedViews[c]=v;this._fireViewChange(c);};F._isAdaptationRequired=function(A){for(var o in A){if(A.hasOwnProperty(o)&&(A[o]===true)){return true;}}return false;};function i(C){if(!C){return false;}return b(C,"sap/m/Label")||b(C,"sap/m/Text")||b(C,"sap/m/Title");}function b(C,t){var T=sap.ui.require(t);return T&&(C instanceof T);}return F;},false);
